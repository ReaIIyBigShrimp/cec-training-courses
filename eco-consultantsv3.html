
<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Ecological Consultants</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous">
<style>
table p {
    margin-bottom: 0;
}
table, table td, table th {
    border: 1px solid #cacaca;
}
</style>
<script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
<!-- <script src="https://cdn.jsdelivr.net/npm/vue@2"></script>  -->
</head>

<body>
<h1>Ecological Consultants in Cheshire East</h1>
<div id="contentTypesContainer">
  <section>
    <div v-if="loading">
      <div class="spinner-grow" role="status"> <!-- <span class="sr-only">Loading...</span> --> </div>
    </div>
    <div class="mt-1 mb-1">
        <button v-on:click="previousPage" type="button" class="btn btn-outline-dark" v-bind:class="{ disabled: currentPageIndex == 0 }">Previous</button>
        <button v-on:click="nextPage" type="button" class="btn btn-outline-dark">Next</button>
    </div>
    <div v-if="loading == false">
        <p>Total results: {{ totalCount }}</p>
        <p>Current page: {{ currentPageIndex+1 }}</p>
    </div>
    <table v-if="loading == false">
      <thead>
        <tr>
          <th scope="col">Name</th>
          <th scope="col">Address</th>
          <th scope="col">Email</th>
          <th scope="col">Phone</th>
          <th scope="col">Fax</th>
          <th scope="col">Mobile</th>
          <th scope="col">Website</th>
          <th scope="row">Additional</th>
        </tr>
      </thead>
      <tbody>
        <tr v-for="item in items">
          <td><p><strong>{{ item.consultantTitle }}</strong></p>
            <p><strong>{{ item.additionalTitle }}</strong></p></td>
          <td><p>{{ item.addressLine1 }}</p>
            <p>{{ item.addressLine2 }}</p>
            <p>{{ item.street }}</p>
            <p>{{ item.town }}</p>
            <p>{{ item.city }}</p>
            <p>{{ item.countyRegion }}</p>
            <p>{{ item.postcode }}</p></td>
          <td v-html="item.email"></td>
          <td>{{ item.phone }}</td>
          <td>{{ item.fax }}</td>
          <td>{{ item.mobile }}</td>
          <td v-html="item.website"></td>
          <td v-html="item.supportingInformation"></td>
        </tr>
      </tbody>
    </table>
  </section>
</div>

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script> 
<script>
        var app = new Vue({
            el: '#contentTypesContainer',
            data() {
                return {
                    url: 'https://cms-chesheast.cloud.contensis.com/api/delivery/projects/Website/contentTypes/ecologicalConsultants/entries/',
                    accessToken: 'QCpZfwnsgnQsyHHB3ID5isS43cZnthj6YoSPtemxFGtcH15I',
                    linkDepth: 5,
                    pageSize: 10,
                    includePageCount: true,
                    items: null,
                    loading: true,
                    errored: false,
                    currentPageIndex: 0,
                    totalCount: null
                }
            },
            filters: {
                currencydecimal(value) {
                    return value.toFixed(2)
                }
            },
            methods: {
                getBaseUrl: function(){
                    var url = this.url
                    // Add access token to URL
                    url = url + '?accessToken='+this.accessToken;
                    // Add link depth to URL
                    url = url + '&linkDepth='+this.linkDepth;
                    // Add page size to URL
                    url = url + '&pageSize=' + this.pageSize;
                    // Add page count to URL
                    if (this.includePageCount) {
                        url = url + '&totalCount';
                    }
                    console.log(url);

                    return url;
                },
                previousPage: function(){
                    if(this.currentPageIndex > 0) {
                        this.loading = true;
                        var prevPageUrl = this.getBaseUrl()+'&pageIndex='+(this.currentPageIndex-1);
                        axios
                        .get(
                            prevPageUrl
                        )
                        .then(response => {
                            this.items = response.data.items;
                            this.loading = false;
                            console.log("Success!!");
                            this.currentPageIndex = this.currentPageIndex - 1;
                            this.loading = false;
                        })
                        .catch(error => {
                            console.log(error)
                            this.errored = true
                        })
                        .finally(() => this.loading = false)
                    }

                    

                    // call API with new URL with page index set
                    console.log('Previous page button...');
                },
                nextPage: function() {
                    // Set loading
                    this.loading = true;
                    // API call with pageIndex parameter
                    var nextPageUrl = this.getBaseUrl()+'&pageIndex='+(this.currentPageIndex+1);

                    axios
                    .get(
                        nextPageUrl
                    )
                    .then(response => {
                        this.items = response.data.items;
                        this.loading = false;
                        console.log("Success!!");
                        this.currentPageIndex = this.currentPageIndex + 1;
                        this.loading = false;
                    })
                    .catch(error => {
                        console.log(error)
                        this.errored = true
                    })
                    .finally(() => this.loading = false)

                    console.log("Next page button...");
                }
            },
            mounted() {
                //this.getBaseUrl();

                axios
                    .get(
                        this.getBaseUrl()
                    )
                    .then(response => {
                        this.items = response.data.items;
                        this.loading = false;
                        this.totalCount = response.data.totalCount;
                        console.log("Success!!");
                        console.log(response);
                    })
                    .catch(error => {
                        console.log(error)
                        this.errored = true
                    })
                    .finally(() => this.loading = false)
            }
        })
        
    </script>
</body>
</html>
